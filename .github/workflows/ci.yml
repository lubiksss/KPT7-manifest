name: Adhoc
on:
  push:
    tags:
      - 'v*.*.*-*'
jobs:
  adhoc:
    runs-on: windows-latest
    strategy:
      matrix:
        keys: [
          'ì¸ì‚¼_1-2',      'ì¸ì‚¼_3-4',     'ì¸ì‚¼_5-6',
          'ì¸ì‚¼_7-8',      'ì¸ì‚¼_9-10',    'ë‚šì‹œìš©í’ˆ_1-2',
          'ë‚šì‹œìš©í’ˆ_3-4',  'ë‚šì‹œìš©í’ˆ_5-6', 'ë‚šì‹œìš©í’ˆ_7-8',
          'ë‚šì‹œìš©í’ˆ_9-10', 'í”Œë¼ì›Œ_1-2',   'í”Œë¼ì›Œ_3-4',
          'í”Œë¼ì›Œ_5-6',    'í”Œë¼ì›Œ_7-8',   'í”Œë¼ì›Œ_9-10',
          'ë¹„ëˆ„_1-2',      'ë¹„ëˆ„_3-4',     'ë¹„ëˆ„_5-6',
          'ë¹„ëˆ„_7-8',      'ë¹„ëˆ„_9-10',    'ë°ì¼ë¦¬_1-2',
          'ë°ì¼ë¦¬_3-4',    'ë°ì¼ë¦¬_5-6',   'ë°ì¼ë¦¬_7-8',
          'ë°ì¼ë¦¬_9-10',   'ì• ê²¬_1-2',     'ì• ê²¬_3-4',
          'ì• ê²¬_5-6',      'ì• ê²¬_7-8',     'ì• ê²¬_9-10',
          'ê·¤_1-2',        'ê·¤_3-4',       'ë°°_1-2',
          'ë°°_3-4',        'ë°°_5-6',       'ë°°_7-8',
          'ë°°_9-10',       'ê°ˆì¹˜_1-2',     'ê°ˆì¹˜_3-4',
          'ê°ˆì¹˜_5-6',      'ê°ˆì¹˜_7-7',     'ì‚¬ê³¼_1-2',
          'ì‚¬ê³¼_3-4',      'ì‚¬ê³¼_5-6',     'ì‚¬ê³¼_7-8',
          'ì‚¬ê³¼_9-10'
        ]
    steps:
      - uses: actions/checkout@v3
        with:
          repository: 'lubiksss/KPT7-daum-site'
          token: ${{ secrets.GH_TOKEN }}
      - uses: actions/setup-node@v3
        with:
          node-version: 14
      - run: npm ci
      - if: ${{ always() }}
        uses: nick-fields/retry@v2
        with:
          #          continue_on_error: true
          timeout_minutes: 180
          max_attempts: 3
          command: npm run start ${{matrix.keys}}
      - if: ${{ always() }}
        uses: actions/upload-artifact@v3
        with:
          name: result
          path: './test/*.xlsx'
          retention-days: 1

  adhoc-noti-success:
    needs: adhoc
    if: ${{ always() && contains(needs.adhoc.result, 'success') }}
    runs-on: ubuntu-latest
    steps:
      - name: Adhoc Success
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            Author: ${{github.actor}}
            Status: ğŸ˜š **Success**
            Action: https://github.com/${{ github.repository }}/actions
            **Adhoc**

  adhoc-noti-fail:
    needs: adhoc
    if: ${{ always() && contains(needs.adhoc.result, 'fail') }}
    runs-on: ubuntu-latest
    steps:
      - name: Adhoc Failure
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            Author: ${{github.actor}}
            Status: ğŸ˜± **Failure**
            Action: https://github.com/${{ github.repository }}/actions
            **Adhoc**
